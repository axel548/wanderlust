name: "Build and Push Docker Image to Docker Hub"
description: "Test Frontend and Backend"

inputs:
  username:
    description: "Docker Hub username"
    required: true
  password:
    description: "Docker Hub password or token"
    required: true

runs:
  using: "composite"
  steps:
    - name: Set environment variables
      run: |
        echo "REGISTRY=axe548/wanderlustdevops" >> $GITHUB_ENV
        echo "IMAGE_NAME_FRONTEND=wanderlust_frontend" >> $GITHUB_ENV
        echo "IMAGE_NAME_FRONTEND_VERSION=wanderlust_frontend-v1.0.1" >> $GITHUB_ENV
        echo "IMAGE_NAME_BACKEND=wanderlust_backend" >> $GITHUB_ENV
        echo "IMAGE_NAME_BACKEND_VERSION=wanderlust_backend-v1.0.1" >> $GITHUB_ENV
      shell: bash

    - name: Check out the repo
      uses: actions/checkout@v2

    - name: Log in to Docker Hub
      uses: docker/login-action@v3
      with:
        username: ${{ inputs.username }}
        password: ${{ inputs.password }}

    - name: Build and push Frontend Docker image
      uses: docker/build-push-action@v6
      with:
        context: .
        file: Dockerfile.frontend
        push: true
        tags: |
          ${REGISTRY}/${IMAGE_NAME_FRONTEND}:${IMAGE_NAME_FRONTEND_VERSION}

    - name: Build and push Backend Docker image
      uses: docker/build-push-action@v6
      with:
        context: .
        file: Dockerfile.backend
        push: true
        tags: |
          ${REGISTRY}/${IMAGE_NAME_BACKEND}:${IMAGE_NAME_BACKEND_VERSION}